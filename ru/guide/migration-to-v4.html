<!DOCTYPE html>
<html lang="ru-RU">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Обновление до v4 | VK-IO</title>
    <meta name="generator" content="VuePress 1.8.1">
    
    <meta name="description" content="Modern VK API SDK for Node.js">
    <meta name="theme-color" content="#44668D">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/vk-io/assets/css/0.styles.93679f13.css" as="style"><link rel="preload" href="/vk-io/assets/js/app.28dba5bf.js" as="script"><link rel="preload" href="/vk-io/assets/js/2.2e8fa611.js" as="script"><link rel="preload" href="/vk-io/assets/js/32.20c47c69.js" as="script"><link rel="prefetch" href="/vk-io/assets/js/10.d6ad57bd.js"><link rel="prefetch" href="/vk-io/assets/js/11.f54d3411.js"><link rel="prefetch" href="/vk-io/assets/js/12.4d3fd2fd.js"><link rel="prefetch" href="/vk-io/assets/js/13.9cf80c0f.js"><link rel="prefetch" href="/vk-io/assets/js/14.59e4afe3.js"><link rel="prefetch" href="/vk-io/assets/js/15.6902dc9e.js"><link rel="prefetch" href="/vk-io/assets/js/16.3e77250d.js"><link rel="prefetch" href="/vk-io/assets/js/17.ee9035f8.js"><link rel="prefetch" href="/vk-io/assets/js/18.df5f5269.js"><link rel="prefetch" href="/vk-io/assets/js/19.33b1847f.js"><link rel="prefetch" href="/vk-io/assets/js/20.e2848f83.js"><link rel="prefetch" href="/vk-io/assets/js/21.4238fe4e.js"><link rel="prefetch" href="/vk-io/assets/js/22.724f165c.js"><link rel="prefetch" href="/vk-io/assets/js/23.fcda1f4c.js"><link rel="prefetch" href="/vk-io/assets/js/24.b6e05fc3.js"><link rel="prefetch" href="/vk-io/assets/js/25.0d023fb2.js"><link rel="prefetch" href="/vk-io/assets/js/26.2b4822ed.js"><link rel="prefetch" href="/vk-io/assets/js/27.93ac28f9.js"><link rel="prefetch" href="/vk-io/assets/js/28.679730fd.js"><link rel="prefetch" href="/vk-io/assets/js/29.e964f665.js"><link rel="prefetch" href="/vk-io/assets/js/3.9c8538fc.js"><link rel="prefetch" href="/vk-io/assets/js/30.fe67c9fb.js"><link rel="prefetch" href="/vk-io/assets/js/31.eda67bc7.js"><link rel="prefetch" href="/vk-io/assets/js/33.3b77d851.js"><link rel="prefetch" href="/vk-io/assets/js/34.e78a5875.js"><link rel="prefetch" href="/vk-io/assets/js/35.a2a6c225.js"><link rel="prefetch" href="/vk-io/assets/js/4.cbdeaccc.js"><link rel="prefetch" href="/vk-io/assets/js/5.5c7d0954.js"><link rel="prefetch" href="/vk-io/assets/js/6.492b107e.js"><link rel="prefetch" href="/vk-io/assets/js/7.03219cbc.js"><link rel="prefetch" href="/vk-io/assets/js/8.ed5d9bda.js"><link rel="prefetch" href="/vk-io/assets/js/9.c357cce8.js">
    <link rel="stylesheet" href="/vk-io/assets/css/0.styles.93679f13.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vk-io/ru/" class="home-link router-link-active"><img src="/vk-io/logo.svg" alt="VK-IO" class="logo"> <span class="site-name can-hide">VK-IO</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vk-io/ru/guide/introduction.html" class="nav-link">
  Guide [RU]
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Community [RU]" class="dropdown-title"><span class="title">Community [RU]</span> <span class="arrow down"></span></button> <button type="button" aria-label="Community [RU]" class="mobile-dropdown-title"><span class="title">Community [RU]</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://t.me/vkio_ru" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Telegram [RU]
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/vk-io/references/" class="nav-link">
  References
</a></div><div class="nav-item"><a href="https://github.com/negezor/vk-io/tree/master/docs/examples" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Examples
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vk-io/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/vk-io/ru/guide/migration-to-v4.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Русский
</a></li></ul></div></div> <a href="https://github.com/negezor/vk-io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vk-io/ru/guide/introduction.html" class="nav-link">
  Guide [RU]
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Community [RU]" class="dropdown-title"><span class="title">Community [RU]</span> <span class="arrow down"></span></button> <button type="button" aria-label="Community [RU]" class="mobile-dropdown-title"><span class="title">Community [RU]</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://t.me/vkio_ru" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Telegram [RU]
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/vk-io/references/" class="nav-link">
  References
</a></div><div class="nav-item"><a href="https://github.com/negezor/vk-io/tree/master/docs/examples" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Examples
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vk-io/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/vk-io/ru/guide/migration-to-v4.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Русский
</a></li></ul></div></div> <a href="https://github.com/negezor/vk-io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Основы</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vk-io/ru/guide/introduction.html" class="sidebar-link">Введение</a></li><li><a href="/vk-io/ru/guide/installation.html" class="sidebar-link">Установка</a></li><li><a href="/vk-io/ru/guide/modules.html" class="sidebar-link">Модули</a></li><li><a href="/vk-io/ru/guide/api.html" class="sidebar-link">API</a></li><li><a href="/vk-io/ru/guide/updates.html" class="sidebar-link">Updates</a></li><li><a href="/vk-io/ru/guide/keyboard.html" class="sidebar-link">Keyboard</a></li><li><a href="/vk-io/ru/guide/utils.html" class="sidebar-link">Utils</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Миграции</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vk-io/ru/guide/migration-to-v4.html" aria-current="page" class="active sidebar-link">Обновление до v4</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vk-io/ru/guide/migration-to-v4.html#tl-dr" class="sidebar-link">TL;DR</a></li><li class="sidebar-sub-header"><a href="/vk-io/ru/guide/migration-to-v4.html#breaking-сhanges" class="sidebar-link">Breaking Сhanges</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="обновление-до-v4"><a href="#обновление-до-v4" class="header-anchor">#</a> Обновление до v4</h1> <p>VK-IO v4 — это следующее мажорное обновление. Ниже приведён список критических изменений, который поможет вам обновиться.</p> <h2 id="tl-dr"><a href="#tl-dr" class="header-anchor">#</a> TL;DR</h2> <ul><li>Были произведены серьёзные изменения в типизации библиотеки</li> <li>Библиотека теперь полностью следует <a href="https://ru.wikipedia.org/wiki/%D0%9D%D0%B5%D0%B8%D0%B7%D0%BC%D0%B5%D0%BD%D1%8F%D0%B5%D0%BC%D1%8B%D0%B9_%D0%BE%D0%B1%D1%8A%D0%B5%D0%BA%D1%82" target="_blank" rel="noopener noreferrer">immutable<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> принципу.</li> <li>Каждый компонент теперь не зависит от основной инстанции <code>VK</code></li> <li>Убраны лишние компоненты в пользу простых функций (например <code>resolveResource()</code> или <code>createCollectIterator()</code>)</li></ul> <details class="custom-block details"><summary>Если ещё короче</summary> <p><img src="https://user-images.githubusercontent.com/9392723/89174354-6d7cd480-d5d1-11ea-8336-9ad40152b812.png" alt="cheems meme"></p></details> <h2 id="breaking-сhanges"><a href="#breaking-сhanges" class="header-anchor">#</a> Breaking Сhanges</h2> <h3 id="поддержка-node-js-12-и-выше"><a href="#поддержка-node-js-12-и-выше" class="header-anchor">#</a> Поддержка Node.js 12 и выше</h3> <p>Библиотека поддерживает теперь только Node.js 12 и выше.</p> <h3 id="vk"><a href="#vk" class="header-anchor">#</a> VK</h3> <ul><li>Удалён геттер/сеттер <code>vk.token</code></li> <li>Удалён метод <code>vk.setOptions()</code></li> <li>Удалён сеттер <code>vk.captchaHandler</code>, используйте метод <code>vk.callbackService.onCaptcha()</code></li> <li>Удалён сеттер <code>vk.twoFactorHandler</code>, используйте метод <code>vk.callbackService.onTwoFactor()</code></li> <li>Удалён модуль <code>vk.auth</code>, используйте вместо этого пакет <a href="https://github.com/negezor/vk-io/tree/master/packages/authorization" target="_blank" rel="noopener noreferrer">@vk-io/authorization<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Удалён модуль <code>vk.streaming</code>, используйте вместо этого пакет <a href="https://github.com/negezor/vk-io/tree/master/packages/streaming" target="_blank" rel="noopener noreferrer">@vk-io/streaming<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Удалён экспорт по умолчанию, используйте именованный</li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import VK from 'vk-io';
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import { VK } from 'vk-io';
</span></span></code></pre></div><ul><li>Удалён <code>vk.snippets.resolveResource()</code>, вместо модуля добавлена функция <code>resolveResource()</code>
Принимает опции вида:</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">IResolveResourceOptions</span> <span class="token punctuation">{</span>
	resource<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
	api<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">API</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Например</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> resolveResource <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vk-io'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">resolveResource</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token comment">// Объект API</span>
	api<span class="token punctuation">,</span>

	resource<span class="token operator">:</span> <span class="token string">'https://vk.com/durov'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>Удалён <code>vk.collect</code>, модуль разбит на мелкие классы и функции</li> <li><ul><li><strong>collect.chain()</strong> - используйте класс <code>new Chain()</code></li></ul></li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Chain <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vk-io'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> chain <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chain</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token comment">// Объект API</span>
	api
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><ul><li><strong>collect.executes()</strong> - используйте функцию <code>executes()</code>
Принимает опции вида:</li></ul></li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">IExecutesOptions</span> <span class="token punctuation">{</span>
	api<span class="token operator">:</span> <span class="token constant">API</span><span class="token punctuation">;</span>

	method<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
	<span class="token comment">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span>
	queue<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Например</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> executes <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vk-io'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">executes</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token comment">// Объект API</span>
	api<span class="token punctuation">,</span>
	
	method<span class="token operator">:</span> <span class="token string">'users.get'</span><span class="token punctuation">,</span>
	queue<span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token punctuation">{</span> user_id<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span> user_id<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span> user_id<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><ul><li><strong>collect.<em>.</em>()</strong> - используйте функцию <code>createCollectIterator()</code>
Принимает опции вида:</li></ul></li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">ICollectIteratorOptions</span> <span class="token punctuation">{</span>
	api<span class="token operator">:</span> <span class="token constant">API</span><span class="token punctuation">;</span>

	method<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
	params<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token operator">&amp;</span> <span class="token punctuation">{</span>
		count<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
		offset<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	maxCount<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
	countPerRequest<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

	retryLimit<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
	parallelRequests<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Например</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createCollectIterator <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vk-io'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> iterator <span class="token operator">=</span> <span class="token function">createCollectIterator</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token comment">// Объект API</span>
	api<span class="token punctuation">,</span>

	method<span class="token operator">:</span> <span class="token string">'messages.getConversations'</span><span class="token punctuation">,</span>
	params<span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token comment">// Будет получать profiles и groups</span>
		extended<span class="token operator">:</span> <span class="token number">1</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token comment">// Максимальный count в методе</span>
	countPerRequest<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>

	<span class="token comment">// Устанавливайте опцию для методов которые не позволяет получить больше N данных, например `users.search`</span>
	<span class="token comment">// maxCount: 1000,</span>

	<span class="token comment">// Количество попыток вызвать снова при ошибке</span>
	<span class="token comment">// retryLimit: 3,</span>

	<span class="token comment">// Количество паралельных вызовов если поддерживается execute</span>
	<span class="token comment">// parallelRequests: 25</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> chunk <span class="token keyword">of</span> iterator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// chunk.received</span>
	<span class="token comment">// chunk.percent</span>
	<span class="token comment">// chunk.total</span>

	<span class="token comment">// chunk.items</span>
	<span class="token comment">// chunk.profiles</span>
	<span class="token comment">// chunk.groups</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="api"><a href="#api" class="header-anchor">#</a> API</h3> <ul><li>Переименование опции <strong>apiAttempts</strong> в <strong>apiRetryLimit</strong></li> <li>Удалён геттер <code>vk.api.API_VERSION</code></li> <li>Enum <code>APIErrorCode</code> теперь автоматический генерируется из <a href="https://github.com/VKCOM/vk-api-schema" target="_blank" rel="noopener noreferrer">схемы<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Объкты схемы теперь экспортируются в своих namespace <code>Params</code>, <code>Objects</code> и <code>Responses</code></li> <li>Удалена автоматическая верификация аккаунта, используйте <code>@vk-io/authorization</code> класс <code>AccountVerification</code></li> <li>Удалена автоматическая установка <code>random_id</code> в <code>api.messages.send()</code>, используйте вместо этого функцию <code>getRandomId()</code></li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> getRandomId <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vk-io'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	peer_id<span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
	random_id<span class="token operator">:</span> <span class="token function">getRandomId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

	text<span class="token operator">:</span> <span class="token string">'Hello!'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="apirequest"><a href="#apirequest" class="header-anchor">#</a> APIRequest</h3> <ul><li>Конструктор теперь принимает опции вида:</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">IAPIRequestOptions</span> <span class="token punctuation">{</span>
	api<span class="token operator">:</span> <span class="token constant">API</span><span class="token punctuation">;</span>

	method<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
	params<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Удалён алиас <code>Request</code>, используйте <code>APIRequest</code></li></ul> <h3 id="attachment-externalattachment"><a href="#attachment-externalattachment" class="header-anchor">#</a> Attachment &amp; ExternalAttachment</h3> <ul><li>Конструктор теперь принимает опции вида:</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">ISharedAttachmentPayload</span> <span class="token punctuation">{</span>
	id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
	owner_id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
	access_key<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">IAttachmentOptions<span class="token operator">&lt;</span><span class="token constant">P</span><span class="token punctuation">,</span> Type <span class="token keyword">extends</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token builtin">string</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
	api<span class="token operator">:</span> <span class="token constant">API</span><span class="token punctuation">;</span>

	<span class="token keyword">type</span><span class="token operator">:</span> Type<span class="token punctuation">;</span>
	payload<span class="token operator">:</span> Partial<span class="token operator">&lt;</span>ISharedAttachmentPayload<span class="token operator">&gt;</span> <span class="token operator">&amp;</span> <span class="token constant">P</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="documentattachment"><a href="#documentattachment" class="header-anchor">#</a> DocumentAttachment</h3> <ul><li>Удалён геттер <code>document.typeName</code></li></ul> <h3 id="context"><a href="#context" class="header-anchor">#</a> Context</h3> <ul><li>Конструктор теперь принимает опции вида:</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">IContextOptions<span class="token operator">&lt;</span>
	<span class="token constant">P</span><span class="token punctuation">,</span>
	<span class="token constant">S</span><span class="token punctuation">,</span>
	Type <span class="token keyword">extends</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
	SubType <span class="token keyword">extends</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token builtin">string</span>
<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
	api<span class="token operator">:</span> <span class="token constant">API</span><span class="token punctuation">;</span>
	upload<span class="token operator">:</span> Upload<span class="token punctuation">;</span>

	<span class="token keyword">type</span><span class="token operator">:</span> Type<span class="token punctuation">;</span>
	subTypes<span class="token operator">:</span> SubType<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

	payload<span class="token operator">:</span> <span class="token constant">P</span><span class="token punctuation">;</span>
	state<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">S</span><span class="token punctuation">;</span>

	source<span class="token operator">:</span> UpdateSource<span class="token punctuation">;</span>
	updateType<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

	groupId<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Метод <code>context.is()</code> принимает теперь массив типов</li></ul> <h3 id="messagecontext"><a href="#messagecontext" class="header-anchor">#</a> MessageContext</h3> <ul><li>Метод <code>context.send()</code> теперь возвращает инстанцию <code>MessageContext</code></li> <li>Геттер <code>context.replyMessage</code> теперь возвращает <code>MessageContext</code> вместо <code>MessageReply</code></li> <li>Геттер <code>context.forwards</code> теперь возвращает массив <code>MessageContext</code> вместо <code>MessageForward</code></li> <li>Изменились входные параметры для методов <code>context.sendPhotos()</code>, <code>context.sendDocuments()</code>, <code>context.sendAudioMessage()</code> и <code>context.sendAudioMessage()</code>. Теперь они принимают объект.</li></ul> <p>Было:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>context<span class="token punctuation">.</span><span class="token function">sendPhotos</span><span class="token punctuation">(</span><span class="token string">'./cat.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Стало:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>context<span class="token punctuation">.</span><span class="token function">sendPhotos</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	value<span class="token operator">:</span> <span class="token string">'./cat.png'</span><span class="token punctuation">,</span>
	<span class="token comment">// filename: 'cat.png',</span>
	<span class="token comment">// contentType: 'image/png',</span>
	<span class="token comment">// contentLength: ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Или</span>

context<span class="token punctuation">.</span><span class="token function">sendPhotos</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	values<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
		value<span class="token operator">:</span> <span class="token string">'./cat.png'</span>
		<span class="token comment">// filename: 'cat.png',</span>
		<span class="token comment">// contentType: 'image/png'</span>
		<span class="token comment">// contentLength: ...</span>
	<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token comment">// timeout: 30_000,</span>
	<span class="token comment">// uploadUrl: '...'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>Удалён метод <code>context.getInviteLink()</code></li> <li>Удалён метод <code>context.markAsImportant()</code></li> <li>Удалён метод <code>context.renameChat()</code></li> <li>Удалён метод <code>context.newChatPhoto()</code></li> <li>Удалён метод <code>context.deleteChatPhoto()</code></li> <li>Удалён метод <code>context.inviteUser()</code></li> <li>Удалён метод <code>context.kickUser()</code></li> <li>Удалён метод <code>context.pinMessage()</code></li> <li>Удалён метод <code>context.unpinMessage()</code></li> <li>Удалён метод <code>context.editMessageText()</code></li> <li>Удалён метод <code>context.sendSticker()</code>, используйте <code>context.send({ sticker_id: 123 })</code></li></ul> <h3 id="commentactioncontext"><a href="#commentactioncontext" class="header-anchor">#</a> CommentActionContext</h3> <ul><li>Переименован в <code>CommentContext</code></li></ul> <h3 id="commentcontext"><a href="#commentcontext" class="header-anchor">#</a> CommentContext</h3> <ul><li>Удалён геттер <code>context.userId</code>, используйте <code>context.fromId</code></li> <li>Удалён геттер <code>context.removerUserId</code>, используйте <code>context.deleterUserId</code></li></ul> <h3 id="messageflagscontext"><a href="#messageflagscontext" class="header-anchor">#</a> MessageFlagsContext</h3> <ul><li>Переименован подтип <code>message_flags_update</code> в <code>message_flags_replace</code></li> <li>Переименован подтип <code>message_flags_set</code> в <code>message_flags_add</code></li> <li>Переименован геттер <code>context.isChat</code> в <code>context.isFromWebChat</code></li> <li>Переименован геттер <code>context.isFriends</code> в <code>context.isFriendMessage</code></li> <li>Переименован геттер <code>context.isSpam</code> в <code>context.isMarkSpam</code></li> <li>Переименован геттер <code>context.isSpam</code> в <code>context.isUnmarkSpam</code></li> <li>Удалён геттер <code>context.isFixed</code></li> <li>Удалён геттер <code>context.isMedia</code></li></ul> <h3 id="dialogflagscontext"><a href="#dialogflagscontext" class="header-anchor">#</a> DialogFlagsContext</h3> <ul><li>Переименован подтип <code>dialog_flags_update</code> в <code>dialog_flags_replace</code></li> <li>Переименован подтип <code>dialog_flags_set</code> в <code>dialog_flags_add</code></li></ul> <h3 id="removedmessagescontext"><a href="#removedmessagescontext" class="header-anchor">#</a> RemovedMessagesContext</h3> <ul><li>Переименован в <code>DialogMessagesContext</code></li></ul> <h3 id="dialogmessagescontext"><a href="#dialogmessagescontext" class="header-anchor">#</a> DialogMessagesContext</h3> <ul><li>Переименован подтип <code>messages_delete</code> в <code>dialog_messages_delete</code></li> <li>Переименован подтип <code>messages_restore</code> в <code>dialog_messages_restore</code></li> <li>Переименован геттер <code>context.id</code> в <code>context.localId</code></li> <li>Переименован геттер <code>context.isRemoved</code> в <code>context.isDelete</code></li> <li>Переименован геттер <code>context.isRecovery</code> в <code>context.isRestore</code></li></ul> <h3 id="useronlinecontext"><a href="#useronlinecontext" class="header-anchor">#</a> UserOnlineContext</h3> <ul><li>Переименован в <code>FriendActivityContext</code></li></ul> <h3 id="friendactivitycontext"><a href="#friendactivitycontext" class="header-anchor">#</a> FriendActivityContext</h3> <ul><li>Переименован подтип <code>user_online</code> в <code>friend_online</code></li> <li>Переименован подтип <code>user_offline</code> в <code>friend_offline</code></li> <li>Переименован геттер <code>context.isUserOnline</code> в <code>context.isOnline</code></li> <li>Переименован геттер <code>context.isUserOffline</code> в <code>context.isOffline</code></li> <li>Переименован геттер <code>context.isSelfExit</code> в <code>context.isSelfLeave</code></li> <li>Переименован геттер <code>context.isTimeoutExit</code> в <code>context.isTimeoutLeave</code></li> <li>Переименован геттер <code>context.createdAt</code> в <code>context.eventAt</code></li> <li>Геттер <code>context.platform</code> теперь возвращает ID платформы</li></ul> <h3 id="readmessagescontext"><a href="#readmessagescontext" class="header-anchor">#</a> ReadMessagesContext</h3> <ul><li>Переименован в <code>MessagesReadContext</code></li></ul> <h3 id="messagesreadcontext"><a href="#messagesreadcontext" class="header-anchor">#</a> MessagesReadContext</h3> <ul><li>Переименован подтип <code>messages_inbox_read</code> в <code>messages_read_inbox</code></li> <li>Переименован подтип <code>messages_outbox_read</code> в <code>messages_read_outbox</code></li> <li>Переименован геттер <code>context.id</code> в <code>context.localId</code></li></ul> <h3 id="messageallowcontext"><a href="#messageallowcontext" class="header-anchor">#</a> MessageAllowContext</h3> <ul><li>Переименован в <code>MessageSubscriptionContext</code></li></ul> <h3 id="messagesubscriptioncontext"><a href="#messagesubscriptioncontext" class="header-anchor">#</a> MessageSubscriptionContext</h3> <ul><li>Тип <code>message_subscribers</code> переименован в <code>message_subscription</code></li></ul> <h3 id="keyboard"><a href="#keyboard" class="header-anchor">#</a> Keyboard</h3> <ul><li>Удалена константа <code>Keyboard.DEFAULT_COLOR</code>, используйте <code>Keyboard.SECONDARY_COLOR</code></li></ul> <h3 id="updates"><a href="#updates" class="header-anchor">#</a> Updates</h3> <ul><li>Все контексты теперь используют <code>undefined</code> вместо <code>null</code> для удобной деструктуризации, например:</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code>updates<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message_new'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">{</span> text <span class="token operator">=</span> <span class="token string">'default text'</span> <span class="token punctuation">}</span> <span class="token operator">=</span> context<span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>text <span class="token operator">===</span> <span class="token string">'default text'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> context<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Вы ничего не написали'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">await</span> context<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>Удалён метод <code>updates.hear()</code> и <code>updates.setHearFallbackHandler()</code>, используйте вместо этого пакет <a href="https://github.com/negezor/vk-io/tree/master/packages/hear" target="_blank" rel="noopener noreferrer">@vk-io/hear<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Теперь используются <a href="https://vk.com/dev/groups_events" target="_blank" rel="noopener noreferrer">официальные именования событий<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
Например</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code>updates<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message_new'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">await</span> context<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>Удален второй аргумент у <code>updates.startWebhook()</code>, вместо этого передавайте функцию в свойство <code>next</code></li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code>updates<span class="token punctuation">.</span><span class="token function">startWebhook</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
	<span class="token function">next</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>Версия polling'а была обновлена до <code>10</code></li> <li>Переименование опции <strong>pollingAttempts</strong> в <strong>pollingRetryLimit</strong></li></ul> <h3 id="upload"><a href="#upload" class="header-anchor">#</a> Upload</h3> <ul><li>Методы <code>upload.storiesPhoto()</code> и <code>upload.storiesVideo()</code> теперь возвращают <code>StoryAttachment</code></li> <li>Удалён метод <code>upload.graffiti()</code>, используйте вместо него <code>upload.documentGraffiti()</code> или <code>upload.messageGraffiti()</code></li> <li>Изменился формат <code>source</code>, теперь он принимает только два интерфейса:</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code>upload<span class="token punctuation">.</span><span class="token function">messagePhoto</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	source<span class="token operator">:</span> <span class="token punctuation">{</span>
		value<span class="token operator">:</span> <span class="token string">'https://picsum.photos/200/300/?image=1'</span><span class="token punctuation">,</span>

		<span class="token comment">// filename: 'image.jpeg',</span>
		<span class="token comment">// contentType: 'image/jpeg'</span>

		<span class="token comment">// contentLength?: number;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Или</p> <div class="language-ts extra-class"><pre class="language-ts"><code>upload<span class="token punctuation">.</span><span class="token function">messagePhoto</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	source<span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token comment">// uploadUrl?: string;</span>
		<span class="token comment">// timeout?: number;</span>
		
		<span class="token comment">// Свойство values может быть массивом если загрузка в альбом</span>
		values<span class="token operator">:</span> <span class="token punctuation">{</span>
			value<span class="token operator">:</span> <span class="token string">'https://picsum.photos/200/300/?image=1'</span><span class="token punctuation">,</span>

			<span class="token comment">// filename: 'image.jpeg',</span>
			<span class="token comment">// contentType: 'image/jpeg</span>

			<span class="token comment">// contentLength?: number;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>У элемента в <code>source</code> появилось свойство <code>contentLength</code>, позволяет указать размер загружаемого файла</li></ul> <blockquote><p>Если вы используете поток который не предоставляет информации о размере в байтах, вам следует указать свойство <code>contentLength</code>, так как иначе файл не будет загружен.
Это особенно актуально для метода <code>upload.video()</code></p></blockquote> <h3 id="callback-service"><a href="#callback-service" class="header-anchor">#</a> Callback Service</h3> <ul><li>Используйте метод <code>callbackService.onCaptcha()</code> вместо сеттера <code>callbackService.captchaHandler</code></li> <li>Используйте метод <code>callbackService.onTwoFactor()</code> вместо сеттера <code>callbackService.twoFactorHandler</code></li></ul> <h3 id="удаленные-экспорты"><a href="#удаленные-экспорты" class="header-anchor">#</a> Удалённые экспорты</h3> <ul><li>Удалён экспорт <code>attachmentTypes</code>, используйте <code>AttachmentType</code></li> <li>Удалён экспорт <code>defaultExtensions</code>, используйте <code>DefaultExtension</code></li> <li>Удалён экспорт <code>defaultContentTypes</code>, используйте <code>DefaultContentType</code></li> <li>Удалён экспорт <code>captchaTypes</code>, используйте <code>CaptchaType</code></li> <li>Удалён экспорт <code>messageSources</code>, используйте <code>MessageSource</code></li> <li>Удалён экспорт <code>resourceTypes</code>, используйте <code>ResourceType</code></li> <li>Удалён экспорт <code>updatesSources</code>, используйте <code>UpdateSource</code></li> <li>Удалён экспорт <code>apiErrors</code>, используйте <code>APIErrorCode</code></li> <li>Удалён экспорт <code>uploadErrors</code>, используйте <code>UploadErrorCode</code></li> <li>Удалён экспорт <code>updatesErrors</code>, используйте <code>UpdatesErrorCode</code></li> <li>Удалён экспорт <code>snippetsErrors</code>, используйте <code>ResourceErrorCode</code></li> <li>Удалён экспорт <code>sharedErrors</code>, используйте <code>SharedErrorCode</code></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">06.10.2020, 19:19:59</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vk-io/ru/guide/utils.html" class="prev">
        Utils
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/vk-io/assets/js/app.28dba5bf.js" defer></script><script src="/vk-io/assets/js/2.2e8fa611.js" defer></script><script src="/vk-io/assets/js/32.20c47c69.js" defer></script>
  </body>
</html>
